const feedbackContainer=document.querySelector("#feedback-articles"),feedbackModal=document.querySelector("#feedback-modal"),modalForm=document.querySelector("#modal-form"),firstNameEl=document.querySelector("#feedback-firstName"),countryEl=document.querySelector("#feedback-country"),emailEl=document.querySelector("#feedback-email"),feedbackEl=document.querySelector("#feedback-textarea"),sendFeedbackBtn=document.querySelector("#send-feedback-button"),feedbackArticles=document.querySelector("#feedback-articles"),feedbackCaptcha=document.querySelector("#feedback-captcha");let validatedFeedbackFirstName,validatedFeedbackEmail,validatedFeedbackCountry,validatedFeedbackText,validatedFeedbackCaptcha;(!pageLang||""==pageLang)&&(pageLang=localStorage.getItem("lang")),firstNameEl.addEventListener("change",e=>{validatedFeedbackFirstName=!!validateInput(e.currentTarget,`${"ua"===pageLang?"Ім'я":"Name"}`,3,30)}),emailEl.addEventListener("change",e=>{validatedFeedbackEmail=!!validateInput(e.currentTarget,"Email",3,45),validateEmail(emailEl)}),countryEl.addEventListener("change",e=>{validatedFeedbackCountry=!!validateInput(e.currentTarget,`${"ua"===pageLang?"Країна":"Country"}`,3,30)}),feedbackEl.addEventListener("change",e=>{validatedFeedbackText=!!validateInput(e.currentTarget,`${"ua"===pageLang?"Відгук":"Feedback"}`,3,1e3)});const setFeedbackAPI=async(e,a,t,d,c)=>{const n={firstName:e,email:t,country:a,feedback:d,date:c,accepted:!1},l={method:"POST",headers:{"Content-type":"application/json","auth-token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI1ZTU2OGI3ZGVhNWE4MzQxM2U0M2RjMTIiLCJpYXQiOjE1ODMwODU3NDN9.xX8_VysEZVWlYVLItbV-Azk88ZT772zjyn0PxyZ0x9Q"},body:JSON.stringify(n)};try{return await fetch("https://bonbonfrancais.herokuapp.com/feedback/",l)}catch(e){console.warn(e)}},setFeedback=async()=>{const e=document.createElement("article"),a=firstNameEl.value,t=countryEl.value,d=emailEl.value,c=feedbackEl.value,n=(new Date).toJSON();validateInput(firstNameEl,`${"ua"===pageLang?"Ім'я":"Name"}`,3,30),validateInput(countryEl,`${"ua"===pageLang?"Країна":"Country"}`,3,30),validateInput(emailEl,"Email",3,45),validateEmail(emailEl),validateInput(feedbackEl,`${"ua"===pageLang?"Відгук":"Feedback"}`,3,1e3),validateFeedbackCaptcha(),validatedFeedbackFirstName&&validatedFeedbackEmail&&validatedFeedbackCountry&&validatedFeedbackText&&validatedFeedbackCaptcha&&(loadingBtnToggle(!0,sendFeedbackBtn),await setFeedbackAPI(a,t,d,c,n).then(d=>{200!==d.status?console.warn("Looks like there was a problem. Status Code: "+d.status,d):e.innerHTML=`\n    <article class="feedback-content container-fluid not-accepted-feedback">\n    <div class="feedback-container row">\n    <div class="feedback-left-col col-sm-12 col-md-3">\n    <h3>${a}</h3>\n    <h4>${t}</h4>\n  </div>\n      <div class="feedback-right-col col-sm-12 col-md-9">\n        <span>"${c}"</span>\n        <p>${n.split("T")[0]}</p>\n      </div>\n      <div class="col-sm-12 feedback-thanks">\n      ${"ua"===pageLang?"<span>Дякую за витрачений час, це дуже важливо для мене! Твій відгук з'явиться на сторінці після модерації.</span>":"<span>Thank you for your time, this is very important for me! Your feedback will appear on the page after moderation.</span>"}\n      </div>\n    </div>\n  </article>\n    `}),feedbackContainer.appendChild(e),acceptSuccessfulModal(feedbackContainer),hideFeedbackModalWindow("feedback-modal"),modalForm.reset(),grecaptcha.reset(0),resetValidatedVariables(),loadingBtnToggle(!1,sendFeedbackBtn))},hideFeedbackModalWindow=e=>{$(`#${e}`).modal("hide")},resetValidatedVariables=()=>{validatedFeedbackFirstName=validatedFeedbackEmail=validatedFeedbackCountry=validatedFeedbackText=validatedFeedbackCaptcha=!1},validateFeedbackCaptcha=async()=>{""!==await grecaptcha.getResponse(0)?(feedbackCaptcha.nextSibling.nextSibling.innerHTML="",validatedFeedbackCaptcha=!0):(feedbackCaptcha.nextSibling.nextSibling.innerHTML=`${"ua"===pageLang?"Підтвердіть будь ласка, що ви не робот.":"Please confirm that you are not a robot"}`,validatedFeedbackCaptcha=!1)};window.validateFeedbackCaptcha=validateFeedbackCaptcha;const clearValidatedFeedbackCaptcha=()=>{validatedFeedbackCaptcha=!1};window.clearValidatedFeedbackCaptcha=clearValidatedFeedbackCaptcha,feedbackCaptcha.setAttribute("data-callback","validateFeedbackCaptcha"),feedbackCaptcha.setAttribute("data-expired-callback","clearValidatedFeedbackCaptcha"),sendFeedbackBtn.addEventListener("click",()=>setFeedback());